/*! @locomotivemtl/charcoal-contrib-tinify 24-02-2019 */

!function(){var t=function(t){Charcoal.Admin.Widget.call(this,t)};(t.prototype=Object.create(Charcoal.Admin.Widget.prototype)).constructor=Charcoal.Admin.Widget_Compression_Dashboard,t.prototype.parent=Charcoal.Admin.Widget.prototype,t.prototype.set_opts=function(t){return this._opts=t,this._options=t.options||{},this},t.prototype.init=function(){this.$widget=this.element(),this.$widget.on("click.compression",".js-optimize-btn",this.on_optimize.bind(this))},t.prototype.on_optimize=function(){var t={size:BootstrapDialog.SIZE_NORMAL,widget_type:"charcoal/tinify/widget/compression",dialog_options:{onhide:function(){void 0!==this._wid&&(Charcoal.Admin.manager().get_widget(this._wid).destroy(),Charcoal.Admin.manager().remove_component("widgets",this._wid))}.bind(this),onhidden:function(){$.each(Charcoal.Admin.manager().components.widgets,function(t,i){i.reload(null,!0)})}}},i=this.dialog(t,function(t){if(t.success){if(!t.widget_id)return!1;this._wid=t.widget_id,Charcoal.Admin.manager().add_widget({id:t.widget_id,type:"charcoal/tinify/widget/compression",close_callback:function(){i.close()}}),Charcoal.Admin.manager().render()}}.bind(this))},t.prototype.parse_options=function(){return this._options=$.extend(!0,{},this._options),this._options},t.prototype.destroy=function(){this.$widget.off("compression")},Charcoal.Admin.Widget_Compression_Dashboard=t}(jQuery,document),function(){var t=function(t){Charcoal.Admin.Widget.call(this,t)};(t.prototype=Object.create(Charcoal.Admin.Widget.prototype)).constructor=Charcoal.Admin.Widget_Compression,t.prototype.parent=Charcoal.Admin.Widget.prototype,t.prototype.set_opts=function(t){return this._options=t.options||{},this._source=null,this._close_callback=t.close_callback,this.$widget=$(this.element()),this.$pBar=this.$widget.find(".js-progress-bar"),this.$pText=this.$widget.find(".js-progress-text"),this},t.prototype.init=function(){this._source=new EventSource("tinify/compress/event"),this._source.addEventListener("CLOSE",function(t){this._source.close(),this._close_callback()}.bind(this)),this._source.addEventListener("message",function(t){var i=JSON.parse(t.data);this.$pBar.css("width",i.progress+"%"),this.$pText.html(i.text)}.bind(this))},t.prototype.destroy=function(){console.log("destroy"),this._source&&this._source.close()},t.prototype.parse_options=function(){return this._options=$.extend(!0,{},this._options),this._options},Charcoal.Admin.Widget_Compression=t}(jQuery,document);